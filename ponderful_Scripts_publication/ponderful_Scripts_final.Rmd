---
title: "ponderful_final"
author: "Jing"
date: "2024-10-18"
output: html_document
---

```{r setup, include=FALSE}
#summary doc https://docs.google.com/document/d/1iPeJf2U94LXMerQuQTlrKJuTU8Uz_uQ9Ikz052mYez0/edit?tab=t.0
knitr::opts_chunk$set(include = FALSE)
library(dplyr)
library(mgcv)
library(ggplot2)
library(nlme)
library(fitdistrplus)
library(bestNormalize)
library(visreg)
library(lmerTest)
library(corrplot)
library(sjPlot)
library(gratia) 
library(patchwork)
library(preprocessCore)
library(boot)
library(MuMIn)
library(lattice)

```

```{r Loading dataset and preparation}
outwdir <- '/Users/lidiayung/PhD_project/project_PONDERFUL/ponderful_Scripts/ponderful_OUTPUT/'
dom_landcover <- read.csv('~/PhD_project/project_PONDERFUL/ponderful_DATA/ponderful_DATA_updated/dom_landcover.csv')


#Factors
##Country as factors
dom_landcover$Country <- as.factor(dom_landcover$Country)
levels(dom_landcover$Country)

##Alternative categories
## Bio climatic regions
dom_landcover$altregion <- 'Atlantic'
dom_landcover[dom_landcover$Country == 'Spain' | dom_landcover$Country == 'Turkey', "altregion"] <- 'Mediterranean'
dom_landcover[dom_landcover$Country == 'Belgium' | dom_landcover$Country == 'Germany'
           | dom_landcover$Country == 'Switzerland', "altregion"] <- 'centralEU'
dom_landcover[dom_landcover$Country == 'Turkey', "altregion"] <- 'Turkey'
#dom_landcover[dom_landcover$Country == 'Uruguay',]$altregion <- 'Uruguay'

##Factors and transformation 
dom_landcover$altregion <- as.factor(dom_landcover$altregion)
levels(dom_landcover$altregion)

#Adding log_TN (and log_TP)
dom_landcover$log_TN <- log(dom_landcover$TN,base=10)
hist(dom_landcover$log_TN)
shapiro.test(dom_landcover$log_TN)

dom_landcover$log_TP <- log(dom_landcover$TP,base=10)
hist(dom_landcover$log_TP)
shapiro.test(dom_landcover$log_TP)


# # Check which columns contain NA values
# na_columns <- sapply(dom_landcover, function(x) any(is.na(x)))
# 
# # Display the names of columns that contain NA values
# columns_with_na <- names(dom_landcover)[na_columns]
# columns_with_na

```
```{r Two histograms }


hist_TN <- ggplot(dom_landcover, aes(x = TN)) + 
  geom_histogram(binwidth = 0.1, fill = "skyblue", color = "black", alpha = 0.7) + 
  labs(
    title = "Distribution of Response Variable TN (n = 211)",
    x = "Total Nitrogen (TN)",
    y = "Frequency"
  ) + 
  theme_minimal(base_size = 15) + 
  theme(
    plot.title = element_text(hjust = 0.5, size = 14),
    axis.title = element_text(size = 14),
    axis.text = element_text(size = 12),
    axis.line = element_line(linewidth = 0.5, colour = "black"), 
    panel.grid.major = element_line(linewidth = 0.5),            
    panel.grid.minor = element_blank()
  )

# Save the plot
ggsave(paste0(outwdir, "TN_distribution_histogram.png"), plot = hist_TN, width = 8, height = 5, dpi = 300)

hist_TP <- ggplot(dom_landcover, aes(x = TP)) + 
  geom_histogram(binwidth = 0.1, fill = "skyblue", color = "black", alpha = 0.7) + 
  labs(
    title = "Distribution of Response Variable TP (n = 211)",
    x = "Total Nitrogen (TP)",
    y = "Frequency"
  ) + 
  theme_minimal(base_size = 15) + 
  theme(
    plot.title = element_text(hjust = 0.5, size = 14),
    axis.title = element_text(size = 14),
    axis.text = element_text(size = 12),
    axis.line = element_line(linewidth = 0.5, colour = "black"), 
    panel.grid.major = element_line(linewidth = 0.5),             
    panel.grid.minor = element_blank()
  )

# Save the plot
ggsave(paste0(outwdir, "TP_distribution_histogram.png"), plot = hist_TP, width = 8, height = 5, dpi = 300)
```



```{r Predictors selection, normalization and standarisation}
#LU variables standerized already. Method used is as follow

transformar_columna <- function(x) {
  perc <- rank(x, na.last = "keep") / (sum(!is.na(x)) + 1)  # Calcular los percentiles manteniendo los NA
  result <- ifelse(!is.na(x), qnorm(perc), NA)  # Transformar los percentiles a la distribuciÃ³n normal, manteniendo los NA
  return(result)}

dom_landcover$Hydeoperiod_length.T<-transformar_columna(dom_landcover$Hydeoperiod_length)

model_df <- dom_landcover[,c('Pondscape','Country','altregion','X','Y','TN','log_TN',
                             'TP','log_TP','bio1.t','bio7.t','bio5.t','bio12.t',
                             'Hydeoperiod_length.t','Hydeoperiod_length.T','Area.t',
                             'Depth.t','Animals_cont.t', "Aquatic_500.t",   
                             "Cropland_500.t","Forest_500.t","Pastures.and.open.nature_500.t" ,
                             "Urban_500.t", "Natural_5.t",'dominant_landcover')]
model_df[,c('bio1.s','bio7.s','bio5.s','bio12.s','Hydeoperiod_length.s',
            'Animals_cont.s','Area.s','Depth.s',"Aquatic_500.s",  
            "Cropland_500.s","Forest_500.s","Pastures.and.open.nature_500.s" ,
            "Urban_500.s", "Natural_5.s")] <-scale(model_df[,c('bio1.t','bio7.t','bio5.t','bio12.t','Hydeoperiod_length.T',
                    'Animals_cont.t','Area.t','Depth.t',"Aquatic_500.t",  
                    "Cropland_500.t","Forest_500.t","Pastures.and.open.nature_500.t" ,
                    "Urban_500.t", "Natural_5.t")], center = TRUE, scale = TRUE)

model_df <-na.omit(model_df)
```

```{r TN glm model}
TN_euromedi_model <- glm(log_TN ~ Natural_5.s + Aquatic_500.s + Cropland_500.s +
                            Pastures.and.open.nature_500.s +
                             Urban_500.s + Animals_cont.s + Area.s + Depth.s +
                             bio1.s+bio7.s+Hydeoperiod_length.s, 
                           data = model_df)
summary(TN_euromedi_model)
step(TN_euromedi_model)

options(na.action = "na.fail")
model_set<- dredge(TN_euromedi_model,m.max=4)
# 
get.models(model_set, 1)[[1]]

TN_euromedi_model_selected <-glm(formula = log_TN ~ Animals_cont.s + bio7.s + Cropland_500.s + 
    Depth.s , data = model_df)

summary(TN_euromedi_model_selected)
tab_model(TN_euromedi_model_selected,show.intercept = TRUE,transform = NULL)

#cross validation
glmfit <- cv.glm(data = model_df, glmfit = TN_euromedi_model_selected,K = 5)
glmfit$delta[2]
```

```{r TP glm model}
TP_euromedi_linear_model <- glm(TP ~ Natural_5.s+Cropland_500.s + Pastures.and.open.nature_500.s + 
                             Animals_cont.s + Depth.s + bio1.s+Hydeoperiod_length.s, family = Gamma(link = "log"),
                           data = model_df)

summary(TP_euromedi_linear_model)
step(TP_euromedi_linear_model)

model_set<- dredge(TP_euromedi_linear_model,m.min=1,m.max=6)
# 


TP_euromedi_model_selected <-  glm(formula = TP ~ Animals_cont.s + bio1.s + Cropland_500.s + 
    Depth.s + Natural_5.s + Pastures.and.open.nature_500.s , family = Gamma(link = "log"), data = model_df)

summary(TP_euromedi_model_selected)
tab_model(TP_euromedi_model_selected,show.intercept = TRUE,transform = NULL)
#cross validation
TP_euromedi_model_selected
glmfit <- cv.glm(data = model_df, glmfit = TP_euromedi_model_selected,K = 5)
glmfit$delta[2]
```

```{r TN GLMM Section I: (A) Country +Pondscape}
#When using dredge, it only remove vars of fixed effect. AIC and anova should be used when compare 

#GLMM random slope without Pondscape dom
TN_euromedi_mixed_1 <-lmer(formula = log_TN ~  Animals_cont.s + bio7.s + Depth.s+Cropland_500.s+
                                 (1|Country) + (1|Country:Pondscape) , data = model_df,na.action = "na.fail") 
summary(TN_euromedi_mixed_1)

TN_euromedi_mixed_1_selected <-lmer(formula = log_TN ~  Animals_cont.s +  Depth.s+Cropland_500.s+
                                 (1|Country) + (1|Country:Pondscape) , data = model_df,na.action = "na.fail") 
anova(TN_euromedi_mixed_1,TN_euromedi_mixed_1_selected)

tab_model(TN_euromedi_mixed_1,show.intercept = TRUE,transform = NULL)
tab_model(TN_euromedi_mixed_1_selected,show.intercept = TRUE,transform = NULL)

dotplot(ranef(TN_euromedi_mixed_1_selected))


################################dredge selected
model_set<- dredge(TN_euromedi_mixed_1)
get.models(model_set, 1)[[1]]

TN_euromedi_dredge_mixed_country_pds <- lmer(formula = log_TN ~  Animals_cont.s + (1|Country) + (1|Country:Pondscape) , data = model_df,na.action = "na.fail") 
dotplot(ranef(TN_euromedi_dredge_mixed_country_pds))
tab_model(TN_euromedi_dredge_mixed_country_pds,show.intercept = TRUE,transform = NULL)
################################dredge selected

#random effect comparison
test1 <-lmer(formula = log_TN ~  Animals_cont.s + bio7.s + Depth.s+Cropland_500.s+
                                 (1|Country), data = model_df,na.action = "na.fail") 
test2 <-lmer(formula = log_TN ~  Animals_cont.s + bio7.s + Depth.s+Cropland_500.s+
                                 (1|Country:Pondscape), data = model_df,na.action = "na.fail") 
anova(TN_euromedi_mixed_1,test1)
anova(TN_euromedi_mixed_1,test2)
anova(TN_euromedi_mixed_1,TN_euromedi_dredge_mixed_country_pds)
```

```{r (B) Country }
TN_euromedi_mixed_2 <-lmer(formula = log_TN ~  Animals_cont.s + bio7.s + Depth.s+Cropland_500.s+
                                 (1|Country)  , data = model_df,na.action = "na.fail") 

summary(TN_euromedi_mixed_2)

TN_euromedi_mixed_2_selected <-lmer(formula = log_TN ~  Animals_cont.s +  Depth.s+Cropland_500.s+
                                 (1|Country) , data = model_df,na.action = "na.fail") 
summary(TN_euromedi_mixed_2_selected)
ranef(TN_euromedi_mixed_2_selected)
tab_model(TN_euromedi_mixed_2_selected,show.intercept = TRUE,transform = NULL)

anova(TN_euromedi_mixed_1_selected,TN_euromedi_mixed_2_selected)
```

```{r (C) (1|Country:Pondscape) }
TN_euromedi_mixed_3 <-lmer(formula = log_TN ~  Animals_cont.s + bio7.s + Depth.s+Cropland_500.s+
                                  (1|Country:Pondscape) , data = model_df,na.action = "na.fail") 

summary(TN_euromedi_mixed_3)
TN_euromedi_mixed_3_selected <-lmer(formula = log_TN ~  Animals_cont.s + Depth.s+Cropland_500.s+
                                  (1|Country:Pondscape) , data = model_df,na.action = "na.fail") 

summary(TN_euromedi_mixed_3_selected)
ranef(TN_euromedi_mixed_3_selected)
tab_model(TN_euromedi_mixed_3_selected,show.intercept = TRUE,transform = NULL)

anova(TN_euromedi_mixed_1_selected,TN_euromedi_mixed_2_selected,TN_euromedi_mixed_3_selected)
```

```{r  Section II: (D)  (1|Dominant_landuse) + (1|Dominant_landuse:Pondscape)}
TN_euromedi_mixed_4 <-lmer(formula = log_TN ~  Animals_cont.s + bio7.s + Depth.s+Cropland_500.s+
                                   (1|dominant_landcover) + (1|dominant_landcover:Pondscape) , data = model_df,na.action = "na.fail") 

summary(TN_euromedi_mixed_4)

TN_euromedi_mixed_4_selected <-lmer(formula = log_TN ~  Animals_cont.s + Depth.s+Cropland_500.s+
                                   (1|dominant_landcover) + (1|dominant_landcover:Pondscape) , data = model_df,na.action = "na.fail") 
summary(TN_euromedi_mixed_4_selected)
ranef(TN_euromedi_mixed_4_selected)
tab_model(TN_euromedi_mixed_4_selected,show.intercept = TRUE,transform = NULL)

anova(TN_euromedi_mixed_1_selected,TN_euromedi_mixed_2_selected,TN_euromedi_mixed_3_selected,TN_euromedi_mixed_4_selected)

```




```{r (E)  (1|Dominant_landuse)}

TN_euromedi_mixed_5 <-lmer(formula = log_TN ~ Natural_5.s + Aquatic_500.s + Cropland_500.s +
                            Pastures.and.open.nature_500.s +
                             Urban_500.s + Animals_cont.s + Area.s + Depth.s +
                             bio1.s+bio7.s+Hydeoperiod_length.s+
                                   (1|dominant_landcover)  , data = model_df,na.action = "na.fail") 

summary(TN_euromedi_mixed_5)

TN_euromedi_mixed_5_test <- lmer(formula = log_TN ~  Aquatic_500.s + Cropland_500.s + Animals_cont.s +Depth.s +
                            bio7.s+(1|dominant_landcover)  , data = model_df,na.action = "na.fail") 


tab_model(TN_euromedi_mixed_5_test,show.intercept = TRUE,transform = NULL)


```

```{r}
TN_random_slope_1 <-lmer(formula = log_TN ~Natural_5.s + Aquatic_500.s + Cropland_500.s +
                            Pastures.and.open.nature_500.s +
                             Urban_500.s + Animals_cont.s + Area.s + Depth.s +
                             bio1.s+bio7.s+Hydeoperiod_length.s+  (1|Country)
                         +(Cropland_500.s|Country) + (Animals_cont.s|Country) ,
                         data = model_df,na.action = "na.fail",control =
                           lmerControl(optimizer = "Nelder_Mead")) 
summary(TN_random_slope_1)

```
```{r second attempt}
TN_random_slope <- lmer(formula = log_TN ~  Animals_cont.s +
                          Depth.s+Cropland_500.s+ (1|Country) +(Cropland_500.s|Country) + 
                          (1|Country:Pondscape) , data = model_df,na.action = "na.fail") 

```

```{r second attempt}
TN_random_slope_2 <-lmer(formula = log_TN ~Natural_5.s + Aquatic_500.s + Cropland_500.s +
                            Pastures.and.open.nature_500.s +
                             Urban_500.s + Animals_cont.s + Area.s + Depth.s +
                             bio1.s+bio7.s+Hydeoperiod_length.s  +(1|dominant_landcover)+ (Cropland_500.s|dominant_landcover) +
                           (Animals_cont.s|dominant_landcover)+ (1|dominant_landcover:Pondscape) ,
                         data = model_df,na.action = "na.fail") 

TN_random_slope_2 <-lmer(formula = log_TN ~Natural_5.s + Aquatic_500.s + Cropland_500.s +
                            Pastures.and.open.nature_500.s +
                             Urban_500.s + Animals_cont.s + Area.s + Depth.s +
                             bio1.s+bio7.s+Hydeoperiod_length.s + (1+Cropland_500.s|dominant_landcover) +
                        (1 + dominant_landcover:Pondscape) ,
                         data = model_df,na.action = "na.fail") 

summary(TN_random_slope_2)

table(model_df$dominant_landcover,model_df$Cropland_500.s)
```


```{r (F) (1|Dominant_landuse:Pondscape)}

TN_euromedi_mixed_6 <-lmer(formula = log_TN ~Natural_5.s + Aquatic_500.s + Cropland_500.s +
                            Pastures.and.open.nature_500.s +
                             Urban_500.s + Animals_cont.s + Area.s + Depth.s +
                             bio1.s+bio7.s+Hydeoperiod_length.s+
                                  (1+Cropland_500.s|dominant_landcover:Pondscape) , data = model_df,na.action = "na.fail",
                            control=lmerControl(optimizer = "nloptwrap")) 
summary(TN_euromedi_mixed_6)

TN_euromedi_mixed_6_selected <- lmer(formula = log_TN ~  Animals_cont.s + Depth.s+Cropland_500.s+bio7.s+
                                  (1+Animals_cont.s|dominant_landcover:Pondscape)  , data = model_df,na.action = "na.fail") 

tab_model(TN_euromedi_mixed_6,show.intercept = TRUE,transform = NULL)

anova(TN_euromedi_mixed_4_selected,TN_euromedi_mixed_5,TN_euromedi_mixed_6_selected)


```

```{r Random slopes Section III: (A): (cropland|Country) + (animals|Country)+ (1|Country:Pondscape)}

TN_euromedi_mixed_7_selected <- lmer(formula = log_TN ~  Animals_cont.s + Depth.s+Cropland_500.s+
                                 (1+Animals_cont.s|Country)+ 
                                   (1|Country:Pondscape), data = model_df,na.action = "na.fail") #singular  by removing + (1+Animals_cont.s|Country) or (1+Cropland_500.s|Country) +  also results is singular



```

```{r (B) (cropland|Country) + (animals|Country)}

TN_euromedi_mixed_8_selected <- lmer(formula = log_TN ~  Animals_cont.s + Depth.s+Cropland_500.s+
                                 (1+Cropland_500.s|Country) + (1+Animals_cont.s|Country), data = model_df,na.action = "na.fail")#singular

```

```{r (C) (cropland|Dominant_landuse) + (animals|Dominant_landuse)+ (1|Dominant_landuse:Pondscape)}


TN_euromedi_mixed_9_selected <- lmer(formula = log_TN ~  Animals_cont.s + Depth.s+Cropland_500.s+
                                 (1+Cropland_500.s|dominant_landcover) + (1+Animals_cont.s|dominant_landcover)+ (1|dominant_landcover:Pondscape), 
                                 data = model_df,na.action = "na.fail") #singular



```

```{r}
model1 <- lmer(log_TN ~Natural_5.s + Aquatic_500.s + 
                            Pastures.and.open.nature_500.s +
                             Urban_500.s + Animals_cont.s + Area.s + Depth.s +
                             bio1.s+bio7.s+Hydeoperiod_length.s +  (1 | Pondscape) + (1 + Animals_cont.s|dominant_landcover),  data = model_df,na.action = "na.fail")

model1 <- lmer(log_TN ~Animals_cont.s  +  (1 | Pondscape) + (1 + Cropland_500.s|Pondscape),  data = model_df,na.action = "na.fail")

model1_selected <- lmer(log_TN ~ Animals_cont.s + Aquatic_500.s + 
                          (1 | Country:Pondscape) + (1 + Cropland_500.s|Pondscape), data = model_df, na.action = "na.fail")

summary(model1)
tab_model(model1)

tab_model(model1_selected)
summary(model1_selected)


```




```{r TP GLMM Section I: (A) Country + Pondscape}

TP_euromedi_mixed_1 <-glmer(formula =TP ~   Animals_cont.s + bio1.s + Cropland_500.s +  Depth.s + Natural_5.s +
                              Pastures.and.open.nature_500.s+(1|Country) + (1|Country:Pondscape) , 
                            data = model_df, family = Gamma(link = "log"), na.action = "na.fail") 
summary(TP_euromedi_mixed_1)


TP_euromedi_mixed_1_test <-glmer(formula =TP ~   Animals_cont.s + Cropland_500.s +  Depth.s +                               Pastures.and.open.nature_500.s+(1|Country) + (1|Country:Pondscape) , 
                            data = model_df, family = Gamma(link = "log"), na.action = "na.fail") 

TP_euromedi_mixed_1_test2 <-glmer(formula =TP ~   Animals_cont.s + Cropland_500.s +  Depth.s +                               Pastures.and.open.nature_500.s+(1|Country)  , 
                            data = model_df, family = Gamma(link = "log"), na.action = "na.fail") 

TP_euromedi_mixed_1_test3 <-glmer(formula =TP ~   Animals_cont.s + Cropland_500.s +  Depth.s +                               Pastures.and.open.nature_500.s+(1|Country:Pondscape)  , 
                            data = model_df, family = Gamma(link = "log"), na.action = "na.fail") 


anova(TP_euromedi_mixed_1,TP_euromedi_mixed_1_selected)

tab_model(TP_euromedi_mixed_1,show.intercept = TRUE,transform = NULL)
tab_model(TP_euromedi_mixed_1_test,show.intercept = TRUE,transform = NULL)
tab_model(TP_euromedi_mixed_1_test2,show.intercept = TRUE,transform = NULL)
tab_model(TP_euromedi_mixed_1_test3,show.intercept = TRUE,transform = NULL)

anova(TP_euromedi_mixed_1,TP_euromedi_mixed_1_test3)
dotplot(ranef(TP_euromedi_mixed_1))

```

```{r (B) (1|Country)}

TP_euromedi_mixed_2 <-glmer(formula =TP ~   Animals_cont.s + bio1.s + Cropland_500.s +  Depth.s + Natural_5.s +
                              Pastures.and.open.nature_500.s+(1|Country) , 
                            data = model_df, family = Gamma(link = "log"), na.action = "na.fail")
summary(TP_euromedi_mixed_2)
tab_model(TP_euromedi_mixed_2,show.intercept = TRUE,transform=NULL)

TP_euromedi_mixed_2_test <- glmer(formula =TP ~   Animals_cont.s +  Cropland_500.s +  Depth.s + 
                              Pastures.and.open.nature_500.s+(1|Country) , 
                            data = model_df, family = Gamma(link = "log"), na.action = "na.fail")
summary(TP_euromedi_mixed_2_test)

anova(TP_euromedi_mixed_2,TP_euromedi_mixed_2_test)
```

```{r (C) (1|Country:Pondscape)	}

TP_euromedi_mixed_3 <-glmer(formula =TP ~   Animals_cont.s + bio1.s + Cropland_500.s +  Depth.s + Natural_5.s +
                              Pastures.and.open.nature_500.s+(1|Country:Pondscape), 
                            data = model_df, family = Gamma(link = "log"), na.action = "na.fail")
summary(TP_euromedi_mixed_3) #natural5 

TP_euromedi_mixed_3_test <- glmer(formula =TP ~   Animals_cont.s + bio1.s + Cropland_500.s +  Depth.s +
                              Pastures.and.open.nature_500.s+(1|Country:Pondscape), 
                            data = model_df, family = Gamma(link = "log"), na.action = "na.fail")

anova(TP_euromedi_mixed_3_test,TP_euromedi_mixed_3)
tab_model(TP_euromedi_mixed_3,show.intercept = TRUE,transform = NULL)

tab_model(TP_euromedi_mixed_3_test,show.intercept = TRUE,transform = NULL)

anova(TP_euromedi_mixed_1,TP_euromedi_mixed_2,TP_euromedi_mixed_3,TP_euromedi_mixed_3_test)
anova(TP_euromedi_mixed_3,TP_euromedi_mixed_3_test)

```

```{r Section II: (D) (1|Dominant_landuse) + (1|Dominant_landuse:Pondscape)}

TP_euromedi_mixed_4 <-glmer(formula =TP ~   Animals_cont.s + bio1.s + Cropland_500.s +  Depth.s + Natural_5.s +
                              Pastures.and.open.nature_500.s+(1|dominant_landcover) + (1|dominant_landcover:Pondscape), 
                            data = model_df, family = Gamma(link = "log"), na.action = "na.fail")
summary(TP_euromedi_mixed_4) #natural5 
tab_model(TP_euromedi_mixed_4,show.intercept = TRUE,transform = NULL)


TP_euromedi_mixed_4_test <-glmer(formula =TP ~   Animals_cont.s + bio1.s + Cropland_500.s +  Depth.s + 
                              Pastures.and.open.nature_500.s+(1|dominant_landcover) + (1|dominant_landcover:Pondscape), 
                            data = model_df, family = Gamma(link = "log"), na.action = "na.fail")
tab_model(TP_euromedi_mixed_4_test,show.intercept = TRUE,transform = NULL)

```

```{r (E) (1|Dominant_landuse)}

TP_euromedi_mixed_5 <-glmer(formula =TP ~   Animals_cont.s + bio1.s + Cropland_500.s +  Depth.s + Natural_5.s +
                              Pastures.and.open.nature_500.s+(1|dominant_landcover) , 
                            data = model_df, family = Gamma(link = "log"), na.action = "na.fail")
summary(TP_euromedi_mixed_5) #natural5 
tab_model(TP_euromedi_mixed_5,show.intercept = TRUE,transform = NULL)

TP_euromedi_mixed_5_test <-glmer(formula =TP ~   Animals_cont.s + bio1.s + Cropland_500.s +  Depth.s + 
                              Pastures.and.open.nature_500.s+(1|dominant_landcover) , 
                            data = model_df, family = Gamma(link = "log"), na.action = "na.fail")
tab_model(TP_euromedi_mixed_5,show.intercept = TRUE,transform = NULL)

```

```{r  (F): (1|Dominant_landuse:Pondscape)}

TP_euromedi_mixed_6 <-glmer(formula =TP ~   Animals_cont.s + bio1.s + Cropland_500.s +  Depth.s + Natural_5.s +
                              Pastures.and.open.nature_500.s+(1|dominant_landcover:Pondscape) , 
                            data = model_df, family = Gamma(link = "log"), na.action = "na.fail")
summary(TP_euromedi_mixed_6) #natural5 
tab_model(TP_euromedi_mixed_6,show.intercept = TRUE,transform = NULL)

TP_euromedi_mixed_6_test <- glmer(formula =TP ~   Animals_cont.s + bio1.s + Cropland_500.s +  Depth.s +
                              Pastures.and.open.nature_500.s+(1|dominant_landcover:Pondscape) , 
                            data = model_df, family = Gamma(link = "log"), na.action = "na.fail")
tab_model(TP_euromedi_mixed_6_test,show.intercept = TRUE,transform = NULL)

anova(TP_euromedi_mixed_4,TP_euromedi_mixed_4_test,TP_euromedi_mixed_5,TP_euromedi_mixed_6,TP_euromedi_mixed_6_test)
```

```{r Rnadom slopes Section III: (1+cropland|Country) + (1+animals|Country)+ (1|Country:Pondscape) }

TP_euromedi_mixed_7 <-glmer(formula =TP ~   Animals_cont.s + bio1.s + Cropland_500.s +  Depth.s + Natural_5.s +
                              Pastures.and.open.nature_500.s+(1+Cropland_500.s|Country) + (1+Animals_cont.s|Country)+ (1|Country:Pondscape) , 
                            data = model_df, family = Gamma(link = "log"), na.action = "na.fail")# singular


```

```{r}

TP_euromedi_mixed_8 <-glmer(formula =TP ~   Animals_cont.s + bio1.s + Cropland_500.s +  Depth.s + Natural_5.s +
                              Pastures.and.open.nature_500.s+(1+Cropland_500.s|Country) + (1+Animals_cont.s|Country), 
                            data = model_df, family = Gamma(link = "log"), na.action = "na.fail")# singular

```

```{r}
TP_euromedi_mixed_9 <-glmer(formula =TP ~   Animals_cont.s + bio1.s + Cropland_500.s +  Depth.s + Natural_5.s +
                              Pastures.and.open.nature_500.s+(1+Cropland_500.s|dominant_landcover) + (1+Animals_cont.s|dominant_landcover)+ (1|dominant_landcover:Pondscape) , 
                            data = model_df, family = Gamma(link = "log"), na.action = "na.fail")

TP_euromedi_mixed_9_test1 <- glmer(formula =TP ~   Animals_cont.s + bio1.s + Cropland_500.s +  Depth.s + Natural_5.s +
                              Pastures.and.open.nature_500.s+(1+Cropland_500.s|dominant_landcover) + (1|dominant_landcover:Pondscape) , 
                            data = model_df, family = Gamma(link = "log"), na.action = "na.fail")
TP_euromedi_mixed_9_test2 <-glmer(formula =TP ~   Animals_cont.s + bio1.s + Cropland_500.s +  Depth.s + Natural_5.s +
                              Pastures.and.open.nature_500.s+(1+Cropland_500.s|dominant_landcover) +  (1|dominant_landcover:Pondscape) , 
                            data = model_df, family = Gamma(link = "log"), na.action = "na.fail")
```

```{r}
TP_euromedi_mixed_10 <-glmer(formula =TP ~   Animals_cont.s + bio1.s + Cropland_500.s +  Depth.s + Natural_5.s +
                              Pastures.and.open.nature_500.s+(1|dominant_landcover)+( Cropland_500.s|dominant_landcover) + (Animals_cont.s|dominant_landcover), 
                            data = model_df, family = Gamma(link = "log"), na.action = "na.fail")
summary(TP_euromedi_mixed_10)
#control = glmerControl(optimizer = "Nelder_Mead")

tab_model(TP_euromedi_mixed_10,transform = NULL, show.intercept = TRUE)
TP_euromedi_mixed_10_test1 <-glmer(formula =TP ~   Animals_cont.s + bio1.s + Cropland_500.s +  Depth.s + Natural_5.s +
                              Pastures.and.open.nature_500.s+(1|dominant_landcover)+( Cropland_500.s|dominant_landcover) , 
                            data = model_df, family = Gamma(link = "log"), na.action = "na.fail")
summary(TP_euromedi_mixed_10_test1)

TP_euromedi_mixed_10_test2 <-glmer(formula =TP ~   Animals_cont.s + bio1.s + Cropland_500.s +  Depth.s + Natural_5.s +
                              Pastures.and.open.nature_500.s+(1|dominant_landcover)+ (Animals_cont.s|dominant_landcover), 
                            data = model_df, family = Gamma(link = "log"), na.action = "na.fail")

anova(TP_euromedi_mixed_10,TP_euromedi_mixed_10_test1)


```









